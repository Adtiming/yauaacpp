#
# Yet Another UserAgent Analyzer
# Copyright (C) 2013-2021 Niels Basjes
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an AS IS BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
config:

- matcher:
    variable:
    - 'Nintendo                            :agent.(1)product.(1)comments.(1)entry.(1-2)text[1]="Nintendo"@'
    extract:
    - 'DeviceClass                         :     2014 :"Game Console"'
    - 'DeviceBrand                         :     2014 :"Nintendo"'
    - 'DeviceName                          :     2014 :@Nintendo'
    - 'OperatingSystemClass                :      100 :"Game Console"'
    - 'OperatingSystemName                 :      100 :"Nintendo"'
    - 'OperatingSystemVersion              :      100 :@Nintendo'

- matcher:
    extract:
    - 'OperatingSystemClass                :     2014 :"Game Console"'
    - 'OperatingSystemName                 :     2014 :"Nintendo NX"'
    - 'OperatingSystemVersion              :     2014 :agent.(3)product.name="NX"^.version'

- matcher:
    extract:
    - 'AgentClass                          :     2014 :"Browser"'
    - 'AgentName                           :     2014 :"NintendoBrowser"'
    - 'AgentVersion                        :     2014 :agent.(4)product.name="NintendoBrowser"^.version'

- matcher:
    variable:
    - 'PlayStationTag                      :agent.(1)product.(1)comments.entry.(1-2)product.name[1]="PlayStation"^'
    - 'PlayStationName                     :Concat["PlayStation ";@PlayStationTag[2]]'
    extract:
    - 'DeviceClass                         :     2014 :"Game Console"'
    - 'DeviceBrand                         :     2014 :"Sony"'
    - 'DeviceName                          :     2014 :@PlayStationName'
    - 'OperatingSystemClass                :     2014 :"Game Console"'
    - 'OperatingSystemName                 :     2014 :@PlayStationName'
    - 'OperatingSystemVersion              :     2014 :@PlayStationTag[3-]'

- lookup:
    name: 'PlayStationOSNames'
    map:
      "3"  : "Cell OS"
      "4"  : "Orbis OS"
      "5"  : "PS5 OS"  # FIXME: 2020-05-22/2021-04-14 Current name of the OS is still unknown

- matcher:
    variable:
    - 'PlayStationTag                      :agent.(1)product.(1)comments.entry.(1-2)product.name[1]="PlayStation"^'
    extract:
    - 'OperatingSystemClass                :     2015 : "Game Console"'
    - 'OperatingSystemName                 :     2015 : LookUp[PlayStationOSNames;@PlayStationTag[2]]'
    - 'OperatingSystemVersion              :     2015 : @PlayStationTag[3-]'

- matcher:
    variable:
    - 'Vita                                :agent.(1)product.(1)comments.entry.product.name="PlayStation Vita"^.version'
    extract:
    - 'DeviceClass                         :     2014 :"Game Console"'
    - 'DeviceBrand                         :     2014 :"Sony"'
    - 'DeviceName                          :     2014 :"PlayStation Vita"'
    - 'DeviceVersion                       :     2014 :@Vita'
    - 'OperatingSystemClass                :     2014 :"Game Console"'
    - 'OperatingSystemName                 :     2014 :"PlayStation Vita"'
    - 'OperatingSystemVersion              :     2014 :@Vita'

# https://www.nintendo.com/3ds/internetbrowser/specs/
# https://www.3dbrew.org/wiki/Internet_Browser
- matcher:
    variable:
    - 'Nintendo                            :agent.(1)product.(1)comments.entry.product.name[1]="Nintendo"^'
    - 'Version                             :agent.product.name="Version"^.version'
    extract:
    - 'DeviceClass                         :     2014 :"Game Console"'
    - 'DeviceBrand                         :     2014 :"Nintendo"'
    - 'DeviceName                          :     2014 :@Nintendo'
    - 'OperatingSystemClass                :     2014 :"Game Console"'
    - 'OperatingSystemName                 :     2014 :"Nintendo"'
    - 'OperatingSystemVersion              :     2014 :@Nintendo'
    - 'LayoutEngineClass                   :     2014 :"Browser"'
    - 'LayoutEngineName                    :     2014 :"Netfront"'
    - 'LayoutEngineVersion                 :     2014 :@Version'
    - 'AgentClass                          :     2014 :"Browser"'
    - 'AgentName                           :     2014 :"Netfront"'
    - 'AgentVersion                        :     2014 :@Version'

- matcher:
    variable:
    - 'Nintendo                            :agent.(1)product.(1)comments.entry.(1-2)text[1]="Nintendo"@'
    - 'Version                             :agent.product.name="Version"^.version'
    extract:
    - 'DeviceClass                         :     2014 :"Game Console"'
    - 'DeviceBrand                         :     2014 :"Nintendo"'
    - 'DeviceName                          :     2014 :@Nintendo'
    - 'OperatingSystemClass                :     2014 :"Game Console"'
    - 'OperatingSystemName                 :     2014 :"Nintendo"'
    - 'OperatingSystemVersion              :     2014 :@Nintendo'
    - 'LayoutEngineClass                   :     2014 :"Browser"'
    - 'LayoutEngineName                    :     2014 :"Netfront"'
    - 'LayoutEngineVersion                 :     2014 :@Version'
    - 'AgentClass                          :     2014 :"Browser"'
    - 'AgentName                           :     2014 :"Netfront"'
    - 'AgentVersion                        :     2014 :@Version'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1-5)text="Xbox"'
    extract:
    - 'DeviceClass                         :     2010 :"Game Console"'
    - 'DeviceBrand                         :     2010 :"Microsoft"'
    - 'DeviceName                          :     2010 :"Xbox"'
    - 'DeviceVersion                       :     2010 :"Xbox 360"'
    - 'OperatingSystemClass                :      101 :"Game Console"'
    - 'OperatingSystemName                 :       98 :"Xbox"'
    - 'OperatingSystemVersion              :       98 :"Xbox 360"'
    - 'OperatingSystemNameVersion          :       98 :"Xbox 360"'

- matcher:
    variable:
    - 'Xbox                                :agent.(1)product.(1)comments.entry.(1-5)text="Xbox"^>'
    extract:
    - 'DeviceClass                         :     2014 :"Game Console"'
    - 'DeviceBrand                         :     2014 :"Microsoft"'
    - 'DeviceName                          :     2014 :"Xbox"'
    - 'DeviceVersion                       :     2014 :@Xbox'
    - 'OperatingSystemClass                :      101 :"Game Console"'
    - 'OperatingSystemName                 :       99 :"Xbox"'
    - 'OperatingSystemVersion              :       99 :@Xbox'
    - 'OperatingSystemNameVersion          :       99 :@Xbox'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Nintendo WiiU) AppleWebKit/536.28 (KHTML, like Gecko) NX/3.0.3.12.15 NintendoBrowser/4.1.1.9601.EU'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Nintendo Wiiu'
      DeviceBrand                          : 'Nintendo'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Nintendo NX'
      OperatingSystemVersion               : '3.0.3.12.15'
      OperatingSystemVersionMajor          : '3'
      OperatingSystemNameVersion           : 'Nintendo NX 3.0.3.12.15'
      OperatingSystemNameVersionMajor      : 'Nintendo NX 3'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '536.28'
      LayoutEngineVersionMajor             : '536'
      LayoutEngineNameVersion              : 'AppleWebKit 536.28'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 536'
      AgentClass                           : 'Browser'
      AgentName                            : 'NintendoBrowser'
      AgentVersion                         : '4.1.1.9601.EU'
      AgentVersionMajor                    : '4'
      AgentNameVersion                     : 'NintendoBrowser 4.1.1.9601.EU'
      AgentNameVersionMajor                : 'NintendoBrowser 4'


- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Nintendo Switch; WifiWebAuthApplet) AppleWebKit/606.4 (KHTML, like Gecko) NF/6.0.1.15.4 NintendoBrowser/5.1.0.20393'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Nintendo Switch'
      DeviceBrand                          : 'Nintendo'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Nintendo'
      OperatingSystemVersion               : 'Nintendo Switch'
      OperatingSystemVersionMajor          : 'Nintendo Switch'
      OperatingSystemNameVersion           : 'Nintendo Switch'
      OperatingSystemNameVersionMajor      : 'Nintendo Switch'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '606.4'
      LayoutEngineVersionMajor             : '606'
      LayoutEngineNameVersion              : 'AppleWebKit 606.4'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 606'
      AgentClass                           : 'Browser'
      AgentName                            : 'NintendoBrowser'
      AgentVersion                         : '5.1.0.20393'
      AgentVersionMajor                    : '5'
      AgentNameVersion                     : 'NintendoBrowser 5.1.0.20393'
      AgentNameVersionMajor                : 'NintendoBrowser 5'



- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Nintendo Switch; WebApplet) AppleWebKit/606.4 (KHTML, like Gecko) NF/6.0.1.16.6 NintendoBrowser/5.1.0.20812'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Nintendo Switch'
      DeviceBrand                          : 'Nintendo'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Nintendo'
      OperatingSystemVersion               : 'Nintendo Switch'
      OperatingSystemVersionMajor          : 'Nintendo Switch'
      OperatingSystemNameVersion           : 'Nintendo Switch'
      OperatingSystemNameVersionMajor      : 'Nintendo Switch'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '606.4'
      LayoutEngineVersionMajor             : '606'
      LayoutEngineNameVersion              : 'AppleWebKit 606.4'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 606'
      AgentClass                           : 'Browser'
      AgentName                            : 'NintendoBrowser'
      AgentVersion                         : '5.1.0.20812'
      AgentVersionMajor                    : '5'
      AgentNameVersion                     : 'NintendoBrowser 5.1.0.20812'
      AgentNameVersionMajor                : 'NintendoBrowser 5'


- test:
    input:
      user_agent_string: 'Opera/9.30 (Nintendo Wii; U; ; 2047-7;es)'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Nintendo WII'
      DeviceBrand                          : 'Nintendo'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Nintendo'
      OperatingSystemVersion               : 'Nintendo Wii'
      OperatingSystemVersionMajor          : 'Nintendo Wii'
      OperatingSystemNameVersion           : 'Nintendo Wii'
      OperatingSystemNameVersionMajor      : 'Nintendo Wii'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Presto'
      LayoutEngineVersion                  : '1'
      LayoutEngineVersionMajor             : '1'
      LayoutEngineNameVersion              : 'Presto 1'
      LayoutEngineNameVersionMajor         : 'Presto 1'
      AgentClass                           : 'Browser'
      AgentName                            : 'Opera'
      AgentVersion                         : '9.30'
      AgentVersionMajor                    : '9'
      AgentNameVersion                     : 'Opera 9.30'
      AgentNameVersionMajor                : 'Opera 9'
      AgentLanguage                        : 'Spanish'
      AgentLanguageCode                    : 'es'
      AgentSecurity                        : 'Strong security'


- test:
    input:
      user_agent_string: 'Opera/9.23 (Nintendo Wii; U; ; 1038-58; Wii Internet Channel/1.0; en)'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Nintendo WII'
      DeviceBrand                          : 'Nintendo'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Nintendo'
      OperatingSystemVersion               : 'Nintendo Wii'
      OperatingSystemVersionMajor          : 'Nintendo Wii'
      OperatingSystemNameVersion           : 'Nintendo Wii'
      OperatingSystemNameVersionMajor      : 'Nintendo Wii'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Presto'
      LayoutEngineVersion                  : '1'
      LayoutEngineVersionMajor             : '1'
      LayoutEngineNameVersion              : 'Presto 1'
      LayoutEngineNameVersionMajor         : 'Presto 1'
      AgentClass                           : 'Browser'
      AgentName                            : 'Opera'
      AgentVersion                         : '9.23'
      AgentVersionMajor                    : '9'
      AgentNameVersion                     : 'Opera 9.23'
      AgentNameVersionMajor                : 'Opera 9'
      AgentLanguage                        : 'English'
      AgentLanguageCode                    : 'en'
      AgentSecurity                        : 'Strong security'


- test:
    input:
      user_agent_string: 'Mozilla/5.0 (PLAYSTATION 3 4.82) AppleWebKit/531.22.8 (KHTML, like Gecko)'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Sony PlayStation 3'
      DeviceBrand                          : 'Sony'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Cell OS'
      OperatingSystemVersion               : '4.82'
      OperatingSystemVersionMajor          : '4'
      OperatingSystemNameVersion           : 'Cell OS 4.82'
      OperatingSystemNameVersionMajor      : 'Cell OS 4'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '531.22.8'
      LayoutEngineVersionMajor             : '531'
      LayoutEngineNameVersion              : 'AppleWebKit 531.22.8'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 531'
      AgentClass                           : 'Browser'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '531.22.8'
      AgentVersionMajor                    : '531'
      AgentNameVersion                     : 'AppleWebKit 531.22.8'
      AgentNameVersionMajor                : 'AppleWebKit 531'


- test:
    input:
      user_agent_string: 'Mozilla/5.0 (PlayStation 4 2.03) AppleWebKit/537.73 (KHTML, like Gecko)'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Sony PlayStation 4'
      DeviceBrand                          : 'Sony'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Orbis OS'
      OperatingSystemVersion               : '2.03'
      OperatingSystemVersionMajor          : '2'
      OperatingSystemNameVersion           : 'Orbis OS 2.03'
      OperatingSystemNameVersionMajor      : 'Orbis OS 2'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '537.73'
      LayoutEngineVersionMajor             : '537'
      LayoutEngineNameVersion              : 'AppleWebKit 537.73'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 537'
      AgentClass                           : 'Browser'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '537.73'
      AgentVersionMajor                    : '537'
      AgentNameVersion                     : 'AppleWebKit 537.73'
      AgentNameVersionMajor                : 'AppleWebKit 537'


# IMPORTANT This is an educated guess (FROM 2019) for the PS5 based on the PS3 and PS4 useragents.
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (PlayStation 5 2.03) AppleWebKit/537.73 (KHTML, like Gecko)'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Sony PlayStation 5'
      DeviceBrand                          : 'Sony'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'PS5 OS'
      OperatingSystemVersion               : '2.03'
      OperatingSystemVersionMajor          : '2'
      OperatingSystemNameVersion           : 'PS5 OS 2.03'
      OperatingSystemNameVersionMajor      : 'PS5 OS 2'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '537.73'
      LayoutEngineVersionMajor             : '537'
      LayoutEngineNameVersion              : 'AppleWebKit 537.73'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 537'
      AgentClass                           : 'Browser'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '537.73'
      AgentVersionMajor                    : '537'
      AgentNameVersion                     : 'AppleWebKit 537.73'
      AgentNameVersionMajor                : 'AppleWebKit 537'


# The real PS5 useragent (2021-04-12)
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (PlayStation; PlayStation 5/2.50) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0 Safari/605.1.15'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Sony PlayStation 5'
      DeviceBrand                          : 'Sony'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'PS5 OS'
      OperatingSystemVersion               : '2.50'
      OperatingSystemVersionMajor          : '2'
      OperatingSystemNameVersion           : 'PS5 OS 2.50'
      OperatingSystemNameVersionMajor      : 'PS5 OS 2'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '605.1.15'
      LayoutEngineVersionMajor             : '605'
      LayoutEngineNameVersion              : 'AppleWebKit 605.1.15'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 605'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '13.0'
      AgentVersionMajor                    : '13'
      AgentNameVersion                     : 'Safari 13.0'
      AgentNameVersionMajor                : 'Safari 13'

# PlayStation 5 after the system update of 2021-04-14
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (PlayStation; PlayStation 5/3.00) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0 Safari/605.1.15'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Sony PlayStation 5'
      DeviceBrand                          : 'Sony'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'PS5 OS'
      OperatingSystemVersion               : '3.00'
      OperatingSystemVersionMajor          : '3'
      OperatingSystemNameVersion           : 'PS5 OS 3.00'
      OperatingSystemNameVersionMajor      : 'PS5 OS 3'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '605.1.15'
      LayoutEngineVersionMajor             : '605'
      LayoutEngineNameVersion              : 'AppleWebKit 605.1.15'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 605'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '14.0'
      AgentVersionMajor                    : '14'
      AgentNameVersion                     : 'Safari 14.0'
      AgentNameVersionMajor                : 'Safari 14'



- test:
    input:
      user_agent_string: 'Mozilla/5.0 (PlayStation Vita 3.36) AppleWebKit/537.73 (KHTML, like Gecko) Silk/3.2'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Sony PlayStation Vita'
      DeviceBrand                          : 'Sony'
      DeviceVersion                        : '3.36'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'PlayStation Vita'
      OperatingSystemVersion               : '3.36'
      OperatingSystemVersionMajor          : '3'
      OperatingSystemNameVersion           : 'PlayStation Vita 3.36'
      OperatingSystemNameVersionMajor      : 'PlayStation Vita 3'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '537.73'
      LayoutEngineVersionMajor             : '537'
      LayoutEngineNameVersion              : 'AppleWebKit 537.73'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 537'
      AgentClass                           : 'Browser'
      AgentName                            : 'Silk'
      AgentVersion                         : '3.2'
      AgentVersionMajor                    : '3'
      AgentNameVersion                     : 'Silk 3.2'
      AgentNameVersionMajor                : 'Silk 3'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry[1-2]="Nintendo 3DS"'
    extract:
    - 'DeviceClass                         :     2100 :"Handheld Game Console"'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Nintendo 3DS; U; ; nl) Version/1.7567.EU'
    expected:
      DeviceClass                          : 'Handheld Game Console'
      DeviceName                           : 'Nintendo 3DS'
      DeviceBrand                          : 'Nintendo'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Nintendo'
      OperatingSystemVersion               : 'Nintendo 3DS'
      OperatingSystemVersionMajor          : 'Nintendo 3DS'
      OperatingSystemNameVersion           : 'Nintendo 3DS'
      OperatingSystemNameVersionMajor      : 'Nintendo 3DS'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Netfront'
      LayoutEngineVersion                  : '1.7567.EU'
      LayoutEngineVersionMajor             : '1'
      LayoutEngineNameVersion              : 'Netfront 1.7567.EU'
      LayoutEngineNameVersionMajor         : 'Netfront 1'
      AgentClass                           : 'Browser'
      AgentName                            : 'Netfront'
      AgentVersion                         : '1.7567.EU'
      AgentVersionMajor                    : '1'
      AgentNameVersion                     : 'Netfront 1.7567.EU'
      AgentNameVersionMajor                : 'Netfront 1'
      AgentLanguage                        : 'Dutch'
      AgentLanguageCode                    : 'nl'
      AgentSecurity                        : 'Strong security'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (New Nintendo 3DS like iPhone) AppleWebKit/536.30 (KHTML, like Gecko) NX/3.0.0.5.22 Mobile NintendoBrowser/1.10.10166.EU'
    expected:
      DeviceClass                          : 'Handheld Game Console'
      DeviceName                           : 'Nintendo NEW 3DS'
      DeviceBrand                          : 'Nintendo'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Nintendo NX'
      OperatingSystemVersion               : '3.0.0.5.22'
      OperatingSystemVersionMajor          : '3'
      OperatingSystemNameVersion           : 'Nintendo NX 3.0.0.5.22'
      OperatingSystemNameVersionMajor      : 'Nintendo NX 3'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '536.30'
      LayoutEngineVersionMajor             : '536'
      LayoutEngineNameVersion              : 'AppleWebKit 536.30'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 536'
      AgentClass                           : 'Browser'
      AgentName                            : 'NintendoBrowser'
      AgentVersion                         : '1.10.10166.EU'
      AgentVersionMajor                    : '1'
      AgentNameVersion                     : 'NintendoBrowser 1.10.10166.EU'
      AgentNameVersionMajor                : 'NintendoBrowser 1'


- test:
    input:
      user_agent_string: 'Opera/9.50 (Nintendo DSi; Opera/507; U; en-GB)'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Nintendo DSI'
      DeviceBrand                          : 'Nintendo'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Nintendo'
      OperatingSystemVersion               : 'Nintendo DSi'
      OperatingSystemVersionMajor          : 'Nintendo DSi'
      OperatingSystemNameVersion           : 'Nintendo DSi'
      OperatingSystemNameVersionMajor      : 'Nintendo DSi'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Presto'
      LayoutEngineVersion                  : '1'
      LayoutEngineVersionMajor             : '1'
      LayoutEngineNameVersion              : 'Presto 1'
      LayoutEngineNameVersionMajor         : 'Presto 1'
      AgentClass                           : 'Browser'
      AgentName                            : 'Opera'
      AgentVersion                         : '9.50'
      AgentVersionMajor                    : '9'
      AgentNameVersion                     : 'Opera 9.50'
      AgentNameVersionMajor                : 'Opera 9'
      AgentLanguage                        : 'English (United Kingdom)'
      AgentLanguageCode                    : 'en-gb'
      AgentSecurity                        : 'Strong security'


- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; Xbox; Xbox One) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Safari/537.36 Edge/13.10553'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Microsoft Xbox'
      DeviceBrand                          : 'Microsoft'
      DeviceCpu                            : 'Intel x86_64'
      DeviceCpuBits                        : '64'
      DeviceVersion                        : 'Xbox One'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemVersionMajor          : '10'
      OperatingSystemNameVersion           : 'Windows 10.0'
      OperatingSystemNameVersionMajor      : 'Windows 10'
      OperatingSystemVersionBuild          : '10553'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'EdgeHTML'
      LayoutEngineVersion                  : '13'
      LayoutEngineVersionMajor             : '13'
      LayoutEngineNameVersion              : 'EdgeHTML 13'
      LayoutEngineNameVersionMajor         : 'EdgeHTML 13'
      AgentClass                           : 'Browser'
      AgentName                            : 'Edge'
      AgentVersion                         : '22.10553' # The 22 is an educated guess.
      AgentVersionMajor                    : '22'
      AgentNameVersion                     : 'Edge 22.10553'
      AgentNameVersionMajor                : 'Edge 22'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0; Xbox)'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Microsoft Xbox'
      DeviceBrand                          : 'Microsoft'
      DeviceVersion                        : 'Xbox 360'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '7'
      OperatingSystemVersionMajor          : '7'
      OperatingSystemNameVersion           : 'Windows 7'
      OperatingSystemNameVersionMajor      : 'Windows 7'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Trident'
      LayoutEngineVersion                  : '5.0'
      LayoutEngineVersionMajor             : '5'
      LayoutEngineNameVersion              : 'Trident 5.0'
      LayoutEngineNameVersionMajor         : 'Trident 5'
      AgentClass                           : 'Browser'
      AgentName                            : 'Internet Explorer'
      AgentVersion                         : '9.0'
      AgentVersionMajor                    : '9'
      AgentNameVersion                     : 'Internet Explorer 9.0'
      AgentNameVersionMajor                : 'Internet Explorer 9'

- test:
    input:
      user_agent_string: 'Opera/9.30 (Nintendo Wii; U; ; 2047-7; nl)'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Nintendo WII'
      DeviceBrand                          : 'Nintendo'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Nintendo'
      OperatingSystemVersion               : 'Nintendo Wii'
      OperatingSystemVersionMajor          : 'Nintendo Wii'
      OperatingSystemNameVersion           : 'Nintendo Wii'
      OperatingSystemNameVersionMajor      : 'Nintendo Wii'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Presto'
      LayoutEngineVersion                  : '1'
      LayoutEngineVersionMajor             : '1'
      LayoutEngineNameVersion              : 'Presto 1'
      LayoutEngineNameVersionMajor         : 'Presto 1'
      AgentClass                           : 'Browser'
      AgentName                            : 'Opera'
      AgentVersion                         : '9.30'
      AgentVersionMajor                    : '9'
      AgentNameVersion                     : 'Opera 9.30'
      AgentNameVersionMajor                : 'Opera 9'
      AgentLanguage                        : 'Dutch'
      AgentLanguageCode                    : 'nl'
      AgentSecurity                        : 'Strong security'

# Seems to be a one of bug situation: https://github.com/Facepunch/garrysmod-issues/issues/2005
#  - test:
#      input:
#        user_agent_string: 'Mozilla/5.0 (%s; U; %s; en-US; Valve Source Client; %s) AppleWebKit/532.1 (KHTML, like Gecko) Chrome/3.0.195.24 Safari/532.1'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.(1)entry="New Nintendo 3DS like iPhone"'
    extract:
    - 'DeviceClass                         :     2014 :"Handheld Game Console"'
    - 'DeviceBrand                         :     2014 :"Nintendo"'
    - 'DeviceName                          :     2014 :"Nintendo New 3DS"'

- matcher:
    require:
    - 'agent.(4)product.name="Mobile NintendoBrowser"'
    extract:
    - 'AgentClass                          :       40 :"Browser"'
    - 'AgentName                           :       40 :"NintendoBrowser"'
    - 'AgentVersion                        :       40 :agent.(4)product.name="Mobile NintendoBrowser"^.version'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (New Nintendo 3DS like iPhone) AppleWebKit/536.30 (KHTML, like Gecko) NX/3.0.0.5.19 Mobile NintendoBrowser/1.6.10147.EU'
    expected:
      DeviceClass                          : 'Handheld Game Console'
      DeviceName                           : 'Nintendo NEW 3DS'
      DeviceBrand                          : 'Nintendo'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Nintendo NX'
      OperatingSystemVersion               : '3.0.0.5.19'
      OperatingSystemVersionMajor          : '3'
      OperatingSystemNameVersion           : 'Nintendo NX 3.0.0.5.19'
      OperatingSystemNameVersionMajor      : 'Nintendo NX 3'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '536.30'
      LayoutEngineVersionMajor             : '536'
      LayoutEngineNameVersion              : 'AppleWebKit 536.30'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 536'
      AgentClass                           : 'Browser'
      AgentName                            : 'NintendoBrowser'
      AgentVersion                         : '1.6.10147.EU'
      AgentVersionMajor                    : '1'
      AgentNameVersion                     : 'NintendoBrowser 1.6.10147.EU'
      AgentNameVersionMajor                : 'NintendoBrowser 1'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.(1)entry.(1)product.name="PSP"'
    - 'agent.(1)product.(1)comments.(1)entry.(1)product.(1)comments.(1)entry.(1)text="PlayStation Portable"'
    extract:
    - 'DeviceClass                         :      500 :"Handheld Game Console"'
    - 'DeviceBrand                         :      500 :"Sony"'
    - 'DeviceName                          :      500 :"PlayStation Portable"'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1)text="PSP PlayStation Portable"'
    extract:
    - 'DeviceClass                         :      500 :"Handheld Game Console"'
    - 'DeviceBrand                         :      500 :"Sony"'
    - 'DeviceName                          :      500 :"PlayStation Portable"'

#http://console.maban.co.uk/
#Sony PSP-Go
- test:
    input:
      user_agent_string: 'Mozilla/4.0 (PSP (PlayStation Portable); 2.00)'
    expected:
      DeviceClass                          : 'Handheld Game Console'
      DeviceName                           : 'Sony PlayStation Portable'
      DeviceBrand                          : 'Sony'
      OperatingSystemClass                 : 'Unknown'
      OperatingSystemName                  : 'Unknown'
      OperatingSystemVersion               : '??'
      OperatingSystemVersionMajor          : '??'
      OperatingSystemNameVersion           : 'Unknown ??'
      OperatingSystemNameVersionMajor      : 'Unknown ??'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Mozilla'
      LayoutEngineVersion                  : '4.0'
      LayoutEngineVersionMajor             : '4'
      LayoutEngineNameVersion              : 'Mozilla 4.0'
      LayoutEngineNameVersionMajor         : 'Mozilla 4'
      AgentClass                           : 'Browser'
      AgentName                            : 'Netscape'
      AgentVersion                         : '4.0'
      AgentVersionMajor                    : '4'
      AgentNameVersion                     : 'Netscape 4.0'
      AgentNameVersionMajor                : 'Netscape 4'


#- test: #TODO: Implement
#    input:
#      user_agent_string: 'Valve/Steam HTTP Client 1.0'
#    expected:
#      DeviceClass                          : 'Unknown' # FIXME: Should be a game console of some sort
#      DeviceName                           : 'Unknown'
#      DeviceBrand                          : 'Unknown'
#      OperatingSystemClass                 : 'Unknown'
#      OperatingSystemName                  : 'Unknown'
#      OperatingSystemVersion               : '??'
#      LayoutEngineClass                    : 'Unknown'
#      LayoutEngineName                     : 'Unknown'
#      LayoutEngineVersion                  : '??'
#      LayoutEngineVersionMajor             : '??'
#      AgentClass                           : 'Special'
#      AgentName                            : 'Valve'
#      AgentVersion                         : 'Steam HTTP Client'
#      AgentVersionMajor                    : 'Steam HTTP Client'
#      AgentNameVersion                     : 'Valve Steam HTTP Client'
#      AgentNameVersionMajor                : 'Valve Steam HTTP Client'
#
#
#- test: #TODO: Implement
#    input:
#      user_agent_string: 'PlayStationNetwork/1.0'
#    expected:
#      DeviceClass                          : 'Unknown'
#      DeviceName                           : 'Unknown'
#      DeviceBrand                          : 'Unknown'
#      OperatingSystemClass                 : 'Unknown'
#      OperatingSystemName                  : 'Unknown'
#      OperatingSystemVersion               : '??'
#      LayoutEngineClass                    : 'Unknown'
#      LayoutEngineName                     : 'Unknown'
#      LayoutEngineVersion                  : '??'
#      LayoutEngineVersionMajor             : '??'
#      AgentClass                           : 'Special'
#      AgentName                            : 'PlayStationNetwork'
#      AgentVersion                         : '1.0'
#      AgentVersionMajor                    : '1'
#      AgentNameVersion                     : 'PlayStationNetwork 1.0'
#      AgentNameVersionMajor                : 'PlayStationNetwork 1'

- test: #Note the missing ; in this one.
    input:
      user_agent_string: 'Mozilla/5.0 (compatible MSIE 9.0 Windows NT 6.1 Trident/5.0 Xbox)'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Microsoft Xbox'
      DeviceBrand                          : 'Microsoft'
      DeviceCpuBits                        : '32'
      DeviceVersion                        : 'Xbox 360'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '7'
      OperatingSystemVersionMajor          : '7'
      OperatingSystemNameVersion           : 'Windows 7'
      OperatingSystemNameVersionMajor      : 'Windows 7'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Trident'
      LayoutEngineVersion                  : '5.0'
      LayoutEngineVersionMajor             : '5'
      LayoutEngineNameVersion              : 'Trident 5.0'
      LayoutEngineNameVersionMajor         : 'Trident 5'
      AgentClass                           : 'Browser'
      AgentName                            : 'Internet Explorer'
      AgentVersion                         : '9.0'
      AgentVersionMajor                    : '9'
      AgentNameVersion                     : 'Internet Explorer 9.0'
      AgentNameVersionMajor                : 'Internet Explorer 9'

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.(1)text="PS2"'
    extract:
    - 'DeviceClass                         :      105 :"Game Console"'
    - 'DeviceBrand                         :     2405 :"Sony"'
    - 'DeviceName                          :     2405 :"Sony PlayStation 2"'
    - 'OperatingSystemClass                :      100 :"Game Console"'

- matcher:
    require:
    - 'agent.(1)product.(1)name{"PS3"'
    extract:
    - 'DeviceClass                         :      105 :"Game Console"'
    - 'DeviceBrand                         :     1405 :"Sony"'
    - 'DeviceName                          :      105 :"Sony PlayStation 3"'
    - 'OperatingSystemClass                :      100 :"Game Console"'
    - 'OperatingSystemName                 :      100 :"CellOS"'
    - 'OperatingSystemVersion              :      100 :"<<<null>>>"'


- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry{"PlayStation 3"'
    extract:
    - 'DeviceClass                         :      105 :"Game Console"'
    - 'DeviceBrand                         :     1405 :"Sony"'
    - 'DeviceName                          :      105 :"Sony PlayStation 3"'
    - 'OperatingSystemClass                :      100 :"Game Console"'
    - 'OperatingSystemName                 :      100 :"CellOS"'
    - 'OperatingSystemVersion              :      100 :"<<<null>>>"'


- test:
    input:
      user_agent_string: 'PS3Application libhttp/4.8.5-000 (CellOS)'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Sony PlayStation 3'
      DeviceBrand                          : 'Sony'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'CellOS'
      OperatingSystemVersion               : '??'
      OperatingSystemVersionMajor          : '??'
      OperatingSystemNameVersion           : 'CellOS ??'
      OperatingSystemNameVersionMajor      : 'CellOS ??'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      LayoutEngineNameVersion              : 'Unknown ??'
      LayoutEngineNameVersionMajor         : 'Unknown ??'
      AgentClass                           : 'Special'
      AgentName                            : 'PS3Application libhttp'
      AgentVersion                         : '4.8.5-000'
      AgentVersionMajor                    : '4'
      AgentNameVersion                     : 'PS3Application libhttp 4.8.5-000'
      AgentNameVersionMajor                : 'PS3Application libhttp 4'


# PlayStation 2
- test:
    input:
      user_agent_string: 'Mozilla/4.0 (PS2; PlayStation BB Navigator 1.0) NetFront/3.0'
    expected:
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Sony PlayStation 2'
      DeviceBrand                          : 'Sony'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'PlayStation BB' # TODO: Is this right?
      OperatingSystemVersion               : 'Navigator 1.0'
      OperatingSystemVersionMajor          : 'Navigator 1'
      OperatingSystemNameVersion           : 'PlayStation BB Navigator 1.0'
      OperatingSystemNameVersionMajor      : 'PlayStation BB Navigator 1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Netfront'
      LayoutEngineVersion                  : '3.0'
      LayoutEngineVersionMajor             : '3'
      LayoutEngineNameVersion              : 'Netfront 3.0'
      LayoutEngineNameVersionMajor         : 'Netfront 3'
      AgentClass                           : 'Browser'
      AgentName                            : 'Netfront'
      AgentVersion                         : '3.0'
      AgentVersionMajor                    : '3'
      AgentNameVersion                     : 'Netfront 3.0'
      AgentNameVersionMajor                : 'Netfront 3'


# PlayStation 3
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (PLAYSTATION 3; 1.00)'
    expected: # TODO: Improve Agent and LayoutEngine ?
      DeviceClass                          : 'Game Console'
      DeviceName                           : 'Sony PlayStation 3'
      DeviceBrand                          : 'Sony'
      OperatingSystemClass                 : 'Game Console'
      OperatingSystemName                  : 'CellOS'
      OperatingSystemVersion               : '??'
      OperatingSystemVersionMajor          : '??'
      OperatingSystemNameVersion           : 'CellOS ??'
      OperatingSystemNameVersionMajor      : 'CellOS ??'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Mozilla'
      LayoutEngineVersion                  : '5.0'
      LayoutEngineVersionMajor             : '5'
      LayoutEngineNameVersion              : 'Mozilla 5.0'
      LayoutEngineNameVersionMajor         : 'Mozilla 5'
      AgentClass                           : 'Browser'
      AgentName                            : 'PLAYSTATION'
      AgentVersion                         : '3'
      AgentVersionMajor                    : '3'
      AgentNameVersion                     : 'PLAYSTATION 3'
      AgentNameVersionMajor                : 'PLAYSTATION 3'
